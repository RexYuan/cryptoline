\documentclass{amsproc}

\usepackage{xspace}
\usepackage{amssymb,amsmath,amsfonts,amsthm}
\usepackage{url}
%\usepackage{tabularray}

\input{macro}

\begin{document}

\title{\cryptoline: A Tutorial}
\author{Jiaxiang Liu}
\author{Xiaomu Shi}
\author{Ming-Hsien Tsai}
\author{Bow-Yaw Wang}
\author{Bo-Yin Yang}
\date{\today}
\maketitle

\section{Introduction}

\cryptoline is a verificaiton tool chain for cryptographic assembly
programs. It contains the \cryptoline model checker and tools for
building models from executable binary codes. \cryptoline is designed
for verifying algebraic properties in cryptographic programs. It has
been used to verify cryptographic assembly programs in \openssl and
\blst, \pqclean, and \pqmfour.

In this tutorial, we explain notable features of \cryptoline through
two running examples from x86\_64 implementations for NIST P-256 curve
in \openssl. Specifically, NIST P-256 curve uses the finite field
$\mZ_{p256}$ where $p256$ is
\[
\mathtt{0xffffffff00000001\ 0000000000000000\ 00000000ffffffff\ 
   ffffffffffffffff}.
\]
We will verify the addition (\texttt{ecp\_nistz256\_add})
and Montegomery multiplication (\texttt{ecp\_nistz256\_mul\_montx})
over the field $\mZ_{p256}$ from \texttt{crypto/ec/asm} in \openssl.
All \cryptoline codes can be found in
\texttt{examples/openss/ecp\_nistz256/x86\_64} from the \cryptoline
distribution. 

\section{\cryptoline Overview}

To verify cryptographic programs with \cryptoline, a verifier has to
construct program models written in the \cryptoline language. Such
program models could be written manually. Manual construction
nevertheless could be tedious or even deviant from real cryptographic
programs. To help verifiers, \cryptoline provides a \python script
\itrace to extract traces from running cryptographic
programs in \gdb. Verifiers will obtain traces of cryptographic 
programs as executed on hardware. Since traces are extracted from
\gdb, they are sequences of assembly instructions from the underlying
hardware architecture. To convert such traces to \cryptoline models,
\cryptoline provides another \python script \tozdsl to
help verifiers transliate assembly instructions to \cryptoline
commands. Through \itrace and \tozdsl, accurate \cryptoline models can
be constructed rather easily. They are indispensable in practice.

Based on the \cryptoline models generated by \tozdsl, verifiers need to
annotate models with input assumptions (or \emph{pre-conditions}) and
output requirements (or \emph{post-conditions}). Additional
annotations are aften required to guide \cryptoline verification
engines as well. After necessary annotations are added, the \cryptoline
verification tool will prove if all post-conditions must hold under
pre-conditions automatically. If \cryptoline fails to prove
post-conditions, hints can be found in \cryptoline log files.
Verifiers can decide whether more annotations are needed or bugs are
found from the hints.

The \cryptoline verification tool employs two engines for proving
different properties about \cryptoline models. The SMT-based engine
calls an external SMT QFBV (Satisfiability Modulo Quantifier-Free
Bit-Vector Theory) solver to prove range properties. The CAS-based
engine calls an external CAS (Computer Algebra System) to prove
algebraic properties. Generally, the SMT-based engine is automatic but
unsuitable for complex non-linear algebraic properties. The CAS-based
engine on the other hand is much better for algebraic properties but
requires more annotations. Verifiers need to choose which engine to
use by their discretion. 

\section{Installing \cryptoline}

\cryptoline is an open-sourced project available at
\url{https://github.com/fmlab-iis/cryptoline}. To download its source
code, type
\begin{verbatim}
$ git clone https://github.com/fmlab-iis/cryptoline.git
\end{verbatim}

\cryptoline is written in \ocaml and requires the \ocaml package
manager \opam, external SMT solvers, and CAS's. Use the following
commands to install the \opam package manager, the SMT solver
\boolector, and the CAS \singular in \ubuntu:
\begin{verbatim}
$ sudo apt-get install opam boolector singular-ui 
\end{verbatim}

Additional \ocaml libraries are needed to compile \cryptoline. To
initialize \opam and install these libraries, use the following
commands:
\begin{verbatim}
$ opam init --disable-sandboxing    # initialize opam
$ eval $(opam env)                  # set up environment variables
$ opam install dune lwt_ppx zarith  # install additional OCaml packages
\end{verbatim}

Finally, go to the \cryptoline directory and compile it with the
following commands:
\begin{verbatim}
$ cd cryptoline
$ dune build
\end{verbatim}

The built \cryptoline binaries are in the \texttt{\_build/\_default}
directory. To make a symbolic link for convenience and check if
everything works fine, try
\begin{verbatim}
$ ln -s _build/default/cv.exe
$ cv.exe -v -isafety examples/openssl/ecp_nistz256/ecp_nistz256_mul_mont.cl
\end{verbatim}

If you see messages similar to the folowing, you are all set!
\begin{verbatim}
Parsing Cryptoline file:                [OK]            0.002074 seconds
Checking well-formedness:               [OK]            0.000732 seconds
Transforming to SSA form:               [OK]            0.000278 seconds
Normalizing specification:              [OK]            0.000017 seconds
Rewriting assignments:                  [OK]            0.000229 seconds
Verifying program safety:
         Cut 0
             Round 1 (32 safety conditions, timeout = 300 seconds)
                 Safety condition #3    [OK]
                 Safety condition #4    [OK]
                 Safety condition #0    [OK]
                 ...
                 Safety condition #28   [OK]
                 Safety condition #31   [OK]
         Overall                        [OK]            5.185277 seconds
Verifying range specification:          [OK]            2.155957 seconds
Rewriting value-preserved casting:      [OK]            0.000023 seconds
Verifying algebraic specification:      [OK]            0.107180 seconds
Verification result:                    [OK]            7.452392 seconds 
\end{verbatim}



\section{\nistzadd in \openssl}



\section{\nistzmul in \openssl}


\end{document}

